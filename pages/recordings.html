---
title: Recordings
summary: The Brown Band is best known for its scrambling, its skating, and its satire, but few people realize that we are also the only student group to carry on many traditions of Brown that would have otherwise been lost. Most important of these traditions are Brown songs, which were composed upwards of a century ago. Today, the Brown Band brings this music out of commencement ceremonies and alumni reunions and into sporting events and campus marches where they can be heard and enjoyed all over Rhode Island.
---

<div id="root">
  <p>
    The page you are trying to view is password protected. Enter the password
    below to proceed. If you have any questions, please email
    band_web@brown.edu.
  </p>
  <form class="row my-3" onsubmit="return false">
    <div class="col-md-8">
      <label for="passwordInput" class="form-label">
        Enter the password here, please.
      </label>
      <input
        required
        type="password"
        class="form-control"
        autofocus
        id="passwordInput"
        placeholder="hunter2"
      />
    </div>
    <div class="col-md-4" style="display: flex; align-items: flex-end">
      <button
        class="btn btn-primary mt-3 decrypt-button"
        type="submit"
        onclick="decrypt()"
        disabled
      >
        Press This Button!
      </button>
    </div>
  </form>
</div>

<script src="/assets/base64-arraybuffer.umd.js"></script>
<script type="module">
  const mediaHost = new URL("{{media_bucket}}");
  const keys = await fetch(new URL("/keys.json", mediaHost)).then((res) =>
    res.json()
  );

  const Base64 = window["base64-arraybuffer"];

  const makeIv = (path) =>
    crypto.subtle
      .digest("SHA-256", new TextEncoder().encode(path))
      .then((buf) => buf.slice(0, 16));

  document.querySelector(".decrypt-button").disabled = false;
  globalThis.decrypt = async () => {
    passwordInput.classList.remove("is-invalid");
    passwordInput.setCustomValidity("");

    const keyData = await crypto.subtle.digest(
      "SHA-256",
      new TextEncoder().encode(passwordInput.value)
    );
    const passwordKey = await crypto.subtle.importKey(
      "raw",
      keyData,
      { name: "AES-CBC" },
      false,
      ["decrypt"]
    );
    const decoder = new TextDecoder();
    const extractedKeys = await Promise.all(
      keys.map(({ iv, data }) =>
        crypto.subtle
          .decrypt(
            { name: "AES-CBC", iv: Base64.decode(iv) },
            passwordKey,
            Base64.decode(data)
          )
          .then((jwk) =>
            crypto.subtle.importKey(
              "jwk",
              JSON.parse(decoder.decode(jwk)),
              { name: "AES-CBC" },
              false,
              ["decrypt"]
            )
          )
          .then(
            (key) => ({ success: true, key }),
            (error) => ({ success: false, error })
          )
      )
    );

    const key = extractedKeys.find((k) => k.success)?.key;
    if (key) {
      globalThis.decryptionKey = key;
      const inventory = await fetch(new URL("/inventory.json", mediaHost))
        .then((res) => res.arrayBuffer())
        .then(async (data) =>
          crypto.subtle.decrypt(
            {
              name: "AES-CBC",
              iv: await makeIv("inventory.json"),
            },
            key,
            data
          )
        )
        .then((decrypted) => JSON.parse(decoder.decode(decrypted)));
      console.log(inventory);
    } else {
      passwordInput.classList.add("is-invalid");
      passwordInput.setCustomValidity(
        "Incorrect Password. Try again or email band_web@brown.edu!"
      );
    }
  };
</script>
